/*!
 * PSPDFKit for Web 2020.2.4 (https://pspdfkit.com/web)
 * 
 * Copyright (c) 2016-2019 PSPDFKit GmbH. All rights reserved.
 * 
 * THIS SOURCE CODE AND ANY ACCOMPANYING DOCUMENTATION ARE PROTECTED BY INTERNATIONAL COPYRIGHT LAW
 * AND MAY NOT BE RESOLD OR REDISTRIBUTED. USAGE IS BOUND TO THE PSPDFKIT LICENSE AGREEMENT.
 * UNAUTHORIZED REPRODUCTION OR DISTRIBUTION IS SUBJECT TO CIVIL AND CRIMINAL PENALTIES.
 * This notice may not be removed from this file.
 * 
 * PSPDFKit uses several open source third-party components: https://pspdfkit.com/acknowledgements/web/
 */
(window.__PSPDFKitChunk=window.__PSPDFKitChunk||[]).push([[60],{782:function(e,t,n){"use strict";n.r(t);var a=n(16),r=n.n(a),o=n(33),s=n.n(o),i=n(60),c=n.n(i),u=n(15),l=n.n(u),d=n(21),h=n.n(d),f=n(6),k=n.n(f),p=n(11),m=n.n(p),v=n(34),b=n(90),y=n(160),w=n(256),P=n(3),x=n(5),F=n(8),_=n.n(F),j=n(7),O=n.n(j),L=n(9),g=n.n(L),E=function(e){function t(){return k()(this,t),_()(this,O()(t).apply(this,arguments))}return g()(t,e),t}(Object(x.e)({alreadyLoadedPages:Object(x.b)(),serverURL:null,authPayload:null,isLoaded:!1,isFormsEnabled:!0,loadBookmarksPromise:null}));n.d(t,"RESTProvider",function(){return S});var S=function(){function e(t,n,a){var r=a.isFormsEnabled;k()(this,e),this.state=new E({serverURL:t,authPayload:n,isFormsEnabled:r})}var t,n,a,o,i,u,d,f,p,F,_,j,O;return m()(e,[{key:"load",value:(O=h()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state=this.state.set("isLoaded",!0),!this.state.isFormsEnabled){e.next=4;break}return e.next=4,this._initializeFormFieldValues();case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}},e,this)})),function(){return O.apply(this,arguments)})},{key:"destroy",value:function(){}},{key:"setAnnotationCallbacks",value:function(e){this.annotationCallbacks=e}},{key:"setBookmarkCallbacks",value:function(e){this.bookmarkCallbacks=e}},{key:"setFormFieldValueCallbacks",value:function(e){this.formFieldValueCallbacks=e}},{key:"createAnnotation",value:(j=h()(l.a.mark(function e(t,n){var a,r,o,s,i=this;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),a=Object(v.o)(t),r=a.id,o=c()(a,["id"]),s={id:r,content:o},e.next=5,this._request("/annotations","POST",s).then(function(e){if(200!==e.status)throw new P.a("PSPDFKit Server returned an error, when saving an annotation.");e.json().then(function(e){if("attachment_missing"===e.error){var t=C(s,n);return i._request("/annotations","POST",t).then(function(e){return e.json()})}return e})});case 5:case"end":return e.stop()}},e,this)})),function(e,t){return j.apply(this,arguments)})},{key:"updateAnnotation",value:(_=h()(l.a.mark(function e(t){var n,a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),n=Object(v.o)(t),a=n.id,r=c()(n,["id"]),e.next=4,this._request("/annotations/".concat(a),"PUT",{id:a,content:r});case 4:case"end":return e.stop()}},e,this)})),function(e){return _.apply(this,arguments)})},{key:"deleteAnnotation",value:(F=h()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),e.next=3,this._request("/annotations/".concat(t),"DELETE");case 3:case"end":return e.stop()}},e,this)})),function(e){return F.apply(this,arguments)})},{key:"createBookmark",value:(p=h()(l.a.mark(function e(t){var n,a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),e.next=3,this.loadBookmarks();case 3:return n=Object(b.b)(t),a=n.id,r=c()(n,["id"]),e.next=6,this._request("/bookmarks","POST",{id:a,content:r});case 6:if(200===e.sent.status){e.next=9;break}throw new P.a("PSPDFKit Server returned an error, when saving an bookmark.");case 9:case"end":return e.stop()}},e,this)})),function(e){return p.apply(this,arguments)})},{key:"updateBookmark",value:(f=h()(l.a.mark(function e(t){var n,a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),e.next=3,this.loadBookmarks();case 3:return n=Object(b.b)(t),a=n.id,r=c()(n,["id"]),e.next=6,this._request("/bookmarks/".concat(a),"PUT",{id:a,content:r});case 6:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"deleteBookmark",value:(d=h()(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),e.next=3,this.loadBookmarks();case 3:return e.next=5,this._request("/bookmarks/".concat(t),"DELETE");case 5:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"setFormFieldValue",value:(u=h()(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this._verifyLoaded(),n={id:"form-field-value/".concat(t.name),content:Object(v.s)(t)},e.next=4,this._request("/form-field-values","POST",{formFieldValues:[n]});case 4:case"end":return e.stop()}},e,this)})),function(e){return u.apply(this,arguments)})},{key:"createFormFieldValue",value:(i=h()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(){return i.apply(this,arguments)})},{key:"deleteFormFieldValue",value:(o=h()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}},e)})),function(){return o.apply(this,arguments)})},{key:"loadAnnotationsForPageIndex",value:(a=h()(l.a.mark(function e(t){var n,a,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._verifyLoaded(),!this.state.alreadyLoadedPages.has(t)){e.next=5;break}return e.next=4,this.state.alreadyLoadedPages.get(t);case 4:return e.abrupt("return");case 5:return e.prev=5,n=this._request("/page-".concat(t,"-annotations"),"GET").then(function(e){return e.json()}).catch(function(e){throw e}),this.state=this.state.setIn(["alreadyLoadedPages",t],n),e.next=10,n;case 10:a=e.sent,this.state=this.state.setIn(["alreadyLoadedPages",t],Promise.resolve()),(r=Object(x.a)().withMutations(function(e){a.annotations.map(function(t){try{e.push(Object(v.c)(t.id,t.content))}catch(e){console.info("Skipped creating annotation #".concat(t.id," from payload because an error occurred while deserializing."),t.content),console.info(e)}})})).size>0&&(Object(P.h)(this.annotationCallbacks),this.annotationCallbacks.createAnnotations(r,Object(x.b)(),y.a)),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(5),this._handleError(e.t0,"annotations");case 19:case"end":return e.stop()}},e,this,[[5,16]])})),function(e){return a.apply(this,arguments)})},{key:"loadBookmarks",value:(n=h()(l.a.mark(function e(){var t,n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._verifyLoaded(),!this.state.loadBookmarksPromise){e.next=5;break}return e.next=4,this.state.loadBookmarksPromise;case 4:return e.abrupt("return");case 5:return e.prev=5,t=this._request("/bookmarks","GET").then(function(e){return e.json()}).then(function(e){return e.data}).catch(function(e){throw e}),this.state=this.state.set("loadBookmarksPromise",t),e.next=10,t;case 10:n=e.sent,this.state=this.state.set("loadBookmarksPromise",Promise.resolve()),Object(P.h)(Array.isArray(n.bookmarks),"Unexpected reply from bookmarks endpoint."),(a=Object(x.a)().withMutations(function(e){n.bookmarks.forEach(function(t){try{e.push(Object(b.a)(t.id,t.content))}catch(e){console.info("Skipped creating bookmark #".concat(t.id," from payload because an error occurred while deserializing."),t),console.info(e)}})})).size>0&&(Object(P.h)(this.bookmarkCallbacks),this.bookmarkCallbacks.createBookmarks(a,w.a)),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(5),this._handleError(e.t0,"bookmarks");case 20:case"end":return e.stop()}},e,this,[[5,17]])})),function(){return n.apply(this,arguments)})},{key:"_initializeFormFieldValues",value:(t=h()(l.a.mark(function e(){var t,n,a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._request("/form-field-values","GET");case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,Object(P.h)(Array.isArray(n.formFieldValues),"Unexpected reply from form-values endpoint."),a=Object(x.a)(n.formFieldValues.map(function(e){var t=e.content;try{return Object(v.f)(t)}catch(e){return console.info("Skipped form field value ".concat(t.name," from payload because an error occurred while deserializing."),t),console.info(e),null}}).filter(Boolean)),Object(P.h)(this.formFieldValueCallbacks),this.formFieldValueCallbacks.setFormFieldValues(a);case 10:case"end":return e.stop()}},e,this)})),function(){return t.apply(this,arguments)})},{key:"_handleError",value:function(e,t){Object(P.g)("Loading or updating ".concat(t," failed:\n\n").concat(e.message))}},{key:"_request",value:function(e,t,n){Object(P.h)(null!=this.state.authPayload,"Cannot call request without authPayload");var a=n instanceof FormData||"object"!==s()(n)?null:{"Content-Type":"application/json"},o=r()({"X-PSPDFKit-Token":this.state.authPayload.token,"PSPDFKit-Platform":"web","PSPDFKit-Version":"protocol=".concat(3,", client=").concat("2020.2.4",", client-git=").concat("06bb712c5a")},a);return fetch("".concat(this.state.serverURL).concat(e),{method:t,headers:o,body:n instanceof FormData?n:"object"===s()(n)?JSON.stringify(n):void 0,credentials:"include"})}},{key:"_verifyLoaded",value:function(){if(!this.state.isLoaded)throw new Error("not loaded")}}]),e}();function C(e,t){var n=new FormData;return n.append("annotation",JSON.stringify(e)),t.forEach(function(e,t){t&&e.data&&n.append(t,e.data)}),n}}}]);